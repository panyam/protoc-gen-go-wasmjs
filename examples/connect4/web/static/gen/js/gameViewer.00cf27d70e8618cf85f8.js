!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("connect4Pages",[],t):"object"==typeof exports?exports.connect4Pages=t():(e.connect4Pages=e.connect4Pages||{},e.connect4Pages.gameViewer=t())}(this,()=>(()=>{"use strict";var e={d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{default:()=>A});var n=function(e,t,n,a){return new(n||(n=Promise))(function(i,s){function o(e){try{c(a.next(e))}catch(e){s(e)}}function r(e){try{c(a.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,r)}c((a=a.apply(e,t||[])).next())})};class a extends Error{constructor(e,t){super(e),this.methodPath=t,this.name="WasmError"}}class i{constructor(e){this.parent=e}getGame(e){return n(this,void 0,void 0,function*(){return this.parent.callMethod("connect4Service.getGame",e)})}dropPiece(e){return n(this,void 0,void 0,function*(){return this.parent.callMethod("connect4Service.dropPiece",e)})}joinGame(e){return n(this,void 0,void 0,function*(){return this.parent.callMethod("connect4Service.joinGame",e)})}createGame(e){return n(this,void 0,void 0,function*(){return this.parent.callMethod("connect4Service.createGame",e)})}}const s=class{constructor(){this.wasmLoadPromise=null,this.connect4Service=new i(this)}loadWasm(){return n(this,arguments,void 0,function*(e="./multiplayer_connect4.wasm"){return this.wasmLoadPromise||(this.wasmLoadPromise=this.loadWASMModule(e)),this.wasmLoadPromise})}isReady(){return null!==this.wasm&&void 0!==this.wasm}waitUntilReady(){return n(this,void 0,void 0,function*(){if(!this.wasmLoadPromise)throw new Error("WASM loading not started. Call loadWasm() first.");yield this.wasmLoadPromise})}callMethod(e,t){this.ensureWASMLoaded();try{const n=JSON.parse(JSON.stringify(t)),i=this.getWasmMethod(e)(JSON.stringify(n));if(!i.success)throw new a(i.message,e);return i.data}catch(t){if(t instanceof a)throw t;throw new a(`Call error: ${t instanceof Error?t.message:String(t)}`,e)}}loadWASMModule(e){return n(this,void 0,void 0,function*(){if(console.log("Loading multiplayer_connect4 WASM module..."),window.multiplayerConnect4)return console.log("WASM module already loaded (pre-loaded in test environment)"),void(this.wasm=window.multiplayerConnect4);if(!window.Go){const e=document.createElement("script");e.src="/static/wasm/wasm_exec.js",document.head.appendChild(e),yield new Promise((t,n)=>{e.onload=()=>t(),e.onerror=()=>n(new Error("Failed to load wasm_exec.js"))})}const t=new window.Go,n=yield WebAssembly.instantiateStreaming(fetch(e),t.importObject);if(t.run(n.instance),!window.multiplayerConnect4)throw new Error("WASM APIs not found - module may not have loaded correctly");this.wasm=window.multiplayerConnect4,console.log("multiplayer_connect4 WASM module loaded successfully")})}ensureWASMLoaded(){if(!this.isReady())throw new Error("WASM module not loaded. Call loadWasm() and waitUntilReady() first.")}getWasmMethod(e){const t=e.split(".");let n=this.wasm;for(const a of t)if(n=n[a],!n)throw new Error(`Method not found: ${e}`);return n}};var o;!function(e){e.STRING="string",e.NUMBER="number",e.BOOLEAN="boolean",e.MESSAGE="message",e.REPEATED="repeated",e.MAP="map",e.ONEOF="oneof"}(o||(o={}));const r={"connect4.GameState":{name:"GameState",fields:[{name:"gameId",type:o.STRING,id:1},{name:"config",type:o.MESSAGE,id:2,messageType:"connect4.GameConfig"},{name:"players",type:o.MESSAGE,id:3,messageType:"connect4.Player",repeated:!0},{name:"board",type:o.MESSAGE,id:4,messageType:"connect4.GameBoard"},{name:"currentPlayerId",type:o.STRING,id:5},{name:"turnNumber",type:o.NUMBER,id:6},{name:"status",type:o.STRING,id:7},{name:"winners",type:o.REPEATED,id:8,repeated:!0},{name:"playerStats",type:o.MESSAGE,id:9,messageType:"connect4.PlayerStatsEntry"},{name:"lastMoveTime",type:o.NUMBER,id:10},{name:"moveTimeoutSeconds",type:o.NUMBER,id:11}]},"connect4.GameConfig":{name:"GameConfig",fields:[{name:"boardWidth",type:o.NUMBER,id:1},{name:"boardHeight",type:o.NUMBER,id:2},{name:"minPlayers",type:o.NUMBER,id:3},{name:"maxPlayers",type:o.NUMBER,id:4},{name:"connectLength",type:o.NUMBER,id:5},{name:"allowMultipleWinners",type:o.BOOLEAN,id:6},{name:"moveTimeoutSeconds",type:o.NUMBER,id:7}]},"connect4.Player":{name:"Player",fields:[{name:"id",type:o.STRING,id:1},{name:"name",type:o.STRING,id:2},{name:"color",type:o.STRING,id:3},{name:"isConnected",type:o.BOOLEAN,id:4},{name:"joinOrder",type:o.NUMBER,id:5}]},"connect4.GameBoard":{name:"GameBoard",fields:[{name:"width",type:o.NUMBER,id:1},{name:"height",type:o.NUMBER,id:2},{name:"rows",type:o.MESSAGE,id:3,messageType:"connect4.BoardRow",repeated:!0},{name:"columnHeights",type:o.REPEATED,id:4,repeated:!0}]},"connect4.BoardRow":{name:"BoardRow",fields:[{name:"cells",type:o.REPEATED,id:1,repeated:!0}]},"connect4.PlayerStats":{name:"PlayerStats",fields:[{name:"piecesPlayed",type:o.NUMBER,id:1},{name:"winningLines",type:o.NUMBER,id:2},{name:"hasWon",type:o.BOOLEAN,id:3},{name:"totalMoveTime",type:o.NUMBER,id:4}]},"connect4.GetGameRequest":{name:"GetGameRequest",fields:[{name:"gameId",type:o.STRING,id:1}]},"connect4.DropPieceRequest":{name:"DropPieceRequest",fields:[{name:"gameId",type:o.STRING,id:1},{name:"playerId",type:o.STRING,id:2},{name:"column",type:o.NUMBER,id:3}]},"connect4.DropPieceResponse":{name:"DropPieceResponse",fields:[{name:"success",type:o.BOOLEAN,id:1},{name:"errorMessage",type:o.STRING,id:2},{name:"changeNumber",type:o.NUMBER,id:4},{name:"result",type:o.MESSAGE,id:5,messageType:"connect4.PieceDropResult"}]},"connect4.PieceDropResult":{name:"PieceDropResult",fields:[{name:"finalRow",type:o.NUMBER,id:1},{name:"finalColumn",type:o.NUMBER,id:2},{name:"formedLine",type:o.BOOLEAN,id:3},{name:"winningLines",type:o.MESSAGE,id:4,messageType:"connect4.LineInfo",repeated:!0}]},"connect4.LineInfo":{name:"LineInfo",fields:[{name:"positions",type:o.MESSAGE,id:1,messageType:"connect4.Position",repeated:!0},{name:"direction",type:o.STRING,id:2},{name:"length",type:o.NUMBER,id:3}]},"connect4.Position":{name:"Position",fields:[{name:"row",type:o.NUMBER,id:1},{name:"column",type:o.NUMBER,id:2}]},"connect4.JoinGameRequest":{name:"JoinGameRequest",fields:[{name:"gameId",type:o.STRING,id:1},{name:"playerName",type:o.STRING,id:2},{name:"preferredColor",type:o.STRING,id:3}]},"connect4.JoinGameResponse":{name:"JoinGameResponse",fields:[{name:"success",type:o.BOOLEAN,id:1},{name:"errorMessage",type:o.STRING,id:2},{name:"playerId",type:o.STRING,id:3},{name:"assignedColor",type:o.STRING,id:4},{name:"gameState",type:o.MESSAGE,id:5,messageType:"connect4.GameState"}]},"connect4.CreateGameRequest":{name:"CreateGameRequest",fields:[{name:"gameId",type:o.STRING,id:1},{name:"config",type:o.MESSAGE,id:2,messageType:"connect4.GameConfig"},{name:"creatorName",type:o.STRING,id:3}]},"connect4.CreateGameResponse":{name:"CreateGameResponse",fields:[{name:"success",type:o.BOOLEAN,id:1},{name:"errorMessage",type:o.STRING,id:2},{name:"playerId",type:o.STRING,id:3},{name:"gameState",type:o.MESSAGE,id:4,messageType:"connect4.GameState"}]}},c=new class{constructor(){this.newGameState=(e,t,n,a)=>({instance:new m,fullyLoaded:!1}),this.newGameConfig=(e,t,n,a)=>({instance:new d,fullyLoaded:!1}),this.newPlayer=(e,t,n,a)=>({instance:new u,fullyLoaded:!1}),this.newGameBoard=(e,t,n,a)=>({instance:new h,fullyLoaded:!1}),this.newBoardRow=(e,t,n,a)=>({instance:new y,fullyLoaded:!1}),this.newPlayerStats=(e,t,n,a)=>({instance:new p,fullyLoaded:!1}),this.newGetGameRequest=(e,t,n,a)=>({instance:new g,fullyLoaded:!1}),this.newDropPieceRequest=(e,t,n,a)=>({instance:new f,fullyLoaded:!1}),this.newDropPieceResponse=(e,t,n,a)=>({instance:new S,fullyLoaded:!1}),this.newPieceDropResult=(e,t,n,a)=>({instance:new E,fullyLoaded:!1}),this.newLineInfo=(e,t,n,a)=>({instance:new w,fullyLoaded:!1}),this.newPosition=(e,t,n,a)=>({instance:new G,fullyLoaded:!1}),this.newJoinGameRequest=(e,t,n,a)=>({instance:new M,fullyLoaded:!1}),this.newJoinGameResponse=(e,t,n,a)=>({instance:new I,fullyLoaded:!1}),this.newCreateGameRequest=(e,t,n,a)=>({instance:new P,fullyLoaded:!1}),this.newCreateGameResponse=(e,t,n,a)=>({instance:new v,fullyLoaded:!1}),this.newTimestamp=(e,t,n,a)=>{if(!a)return{instance:new Date,fullyLoaded:!0};let i;if("string"==typeof a)i=new Date(a);else if(void 0!==a.seconds){const e="string"==typeof a.seconds?parseInt(a.seconds,10):a.seconds,t=a.nanos||0;i=new Date(1e3*e+Math.floor(t/1e6))}else i=new Date;return{instance:i,fullyLoaded:!0}},this.newFieldMask=(e,t,n,a)=>{if(!a)return{instance:[],fullyLoaded:!0};let i;return i=Array.isArray(a)?a:a.paths&&Array.isArray(a.paths)?a.paths:[],{instance:i,fullyLoaded:!0}}}getFactoryMethod(e){const t=e.split(".");if(t.length<2)return;const n=t.slice(0,-1).join("."),a=t[t.length-1];if("connect4"===n)return this["new"+a];return this.externalTypeFactories()[e]||void 0}deserializeObject(e,t){if(!t||"object"!=typeof t)return e;for(const[n,a]of Object.entries(t))null!=a&&(e[n]=a);return e}externalTypeFactories(){return{"google.protobuf.Timestamp":this.newTimestamp,"google.protobuf.FieldMask":this.newFieldMask}}serializeTimestamp(e){return e?{seconds:Math.floor(e.getTime()/1e3).toString(),nanos:e.getTime()%1e3*1e6}:null}serializeFieldMask(e){return e&&Array.isArray(e)?{paths:e}:null}};class l{constructor(e=r,t=c){this.schemaRegistry=e,this.factory=t}deserialize(e,t,n){if(!t||"object"!=typeof t)return e;const a=this.schemaRegistry[n];if(!a)return this.fallbackDeserialize(e,t);for(const n of a.fields){const a=t[n.name];null!=a&&this.deserializeField(e,n,a)}return e}deserializeField(e,t,n){const a=t.name;switch(t.type){case o.STRING:case o.NUMBER:case o.BOOLEAN:e[a]=n;break;case o.MESSAGE:t.repeated?e[a]=this.deserializeMessageArray(n,t.messageType,e,a):e[a]=this.deserializeMessageField(n,t.messageType,e,a);break;case o.REPEATED:Array.isArray(n)&&(e[a]=[...n]);break;case o.ONEOF:e[a]=n;break;case o.MAP:e[a]=Object.assign({},n);break;default:e[a]=n}}deserializeMessageField(e,t,n,a){let i;if(this.factory.getFactoryMethod)i=this.factory.getFactoryMethod(t);else{const e=this.getFactoryMethodName(t);i=this.factory[e]}if(i){const s=i(n,a,void 0,e);return s.fullyLoaded?s.instance:this.deserialize(s.instance,e,t)}return this.fallbackDeserialize({},e)}deserializeMessageArray(e,t,n,a){if(!Array.isArray(e))return[];let i;if(this.factory.getFactoryMethod)i=this.factory.getFactoryMethod(t);else{const e=this.getFactoryMethodName(t);i=this.factory[e]}return e.map((e,s)=>{if(i){const o=i(n,a,s,e);return o.fullyLoaded?o.instance:this.deserialize(o.instance,e,t)}return this.fallbackDeserialize({},e)})}getFactoryMethodName(e){const t=e.split(".");return"new"+t[t.length-1]}fallbackDeserialize(e,t){if(!t||"object"!=typeof t)return e;for(const[n,a]of Object.entries(t))null!=a&&(e[n]=a);return e}createAndDeserialize(e,t){let n;if(this.factory.getFactoryMethod)n=this.factory.getFactoryMethod(e);else{const t=this.getFactoryMethodName(e);n=this.factory[t]}if(!n)throw new Error(`Could not find factory method to deserialize: ${e}`);const a=n(void 0,void 0,void 0,t);return a.fullyLoaded?a.instance:this.deserialize(a.instance,t,e)}static from(e,t){return(new l).createAndDeserialize(e,t)}}class m{constructor(){this.gameId="",this.players=[],this.currentPlayerId="",this.turnNumber=0,this.status=0,this.winners=[],this.lastMoveTime=0,this.moveTimeoutSeconds=0}static from(e){return l.from(m.MESSAGE_TYPE,e)}}m.MESSAGE_TYPE="connect4.GameState";class d{constructor(){this.boardWidth=0,this.boardHeight=0,this.minPlayers=0,this.maxPlayers=0,this.connectLength=0,this.allowMultipleWinners=!1,this.moveTimeoutSeconds=0}static from(e){return l.from(d.MESSAGE_TYPE,e)}}d.MESSAGE_TYPE="connect4.GameConfig";class u{constructor(){this.id="",this.name="",this.color="",this.isConnected=!1,this.joinOrder=0}static from(e){return l.from(u.MESSAGE_TYPE,e)}}u.MESSAGE_TYPE="connect4.Player";class h{constructor(){this.width=0,this.height=0,this.rows=[],this.columnHeights=[]}static from(e){return l.from(h.MESSAGE_TYPE,e)}}h.MESSAGE_TYPE="connect4.GameBoard";class y{constructor(){this.cells=[]}static from(e){return l.from(y.MESSAGE_TYPE,e)}}y.MESSAGE_TYPE="connect4.BoardRow";class p{constructor(){this.piecesPlayed=0,this.winningLines=0,this.hasWon=!1,this.totalMoveTime=0}static from(e){return l.from(p.MESSAGE_TYPE,e)}}p.MESSAGE_TYPE="connect4.PlayerStats";class g{constructor(){this.gameId=""}static from(e){return l.from(g.MESSAGE_TYPE,e)}}g.MESSAGE_TYPE="connect4.GetGameRequest";class f{constructor(){this.gameId="",this.playerId="",this.column=0}static from(e){return l.from(f.MESSAGE_TYPE,e)}}f.MESSAGE_TYPE="connect4.DropPieceRequest";class S{constructor(){this.success=!1,this.errorMessage="",this.changeNumber=0}static from(e){return l.from(S.MESSAGE_TYPE,e)}}S.MESSAGE_TYPE="connect4.DropPieceResponse";class E{constructor(){this.finalRow=0,this.finalColumn=0,this.formedLine=!1,this.winningLines=[]}static from(e){return l.from(E.MESSAGE_TYPE,e)}}E.MESSAGE_TYPE="connect4.PieceDropResult";class w{constructor(){this.positions=[],this.direction="",this.length=0}static from(e){return l.from(w.MESSAGE_TYPE,e)}}w.MESSAGE_TYPE="connect4.LineInfo";class G{constructor(){this.row=0,this.column=0}static from(e){return l.from(G.MESSAGE_TYPE,e)}}G.MESSAGE_TYPE="connect4.Position";class M{constructor(){this.gameId="",this.playerName="",this.preferredColor=""}static from(e){return l.from(M.MESSAGE_TYPE,e)}}M.MESSAGE_TYPE="connect4.JoinGameRequest";class I{constructor(){this.success=!1,this.errorMessage="",this.playerId="",this.assignedColor=""}static from(e){return l.from(I.MESSAGE_TYPE,e)}}I.MESSAGE_TYPE="connect4.JoinGameResponse";class P{constructor(){this.gameId="",this.creatorName=""}static from(e){return l.from(P.MESSAGE_TYPE,e)}}P.MESSAGE_TYPE="connect4.CreateGameRequest";class v{constructor(){this.success=!1,this.errorMessage="",this.playerId=""}static from(e){return l.from(v.MESSAGE_TYPE,e)}}v.MESSAGE_TYPE="connect4.CreateGameResponse";var R=function(e,t,n,a){return new(n||(n=Promise))(function(i,s){function o(e){try{c(a.next(e))}catch(e){s(e)}}function r(e){try{c(a.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,r)}c((a=a.apply(e,t||[])).next())})};const T=new class{constructor(){this.elements={};const e=window.location.pathname.split("/").filter(e=>e)[0]||"";this.ui={gameId:e,playerId:"",gameState:null,statefulProxy:null,connect4Client:null},this.init()}init(){return R(this,void 0,void 0,function*(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.initializeUI()):this.initializeUI()})}initializeUI(){if(this.elements={joinGameForm:document.getElementById("joinGameForm"),gameInterface:document.getElementById("gameInterface"),errorState:document.getElementById("errorState"),gameBoard:document.getElementById("gameBoard"),gameStatus:document.getElementById("gameStatus"),currentPlayerName:document.getElementById("currentPlayerName"),currentPlayerColor:document.getElementById("currentPlayerColor"),turnNumber:document.getElementById("turnNumber"),playersList:document.getElementById("playersList"),gameLog:document.getElementById("gameLog"),currentGameId:document.getElementById("currentGameId"),gameUrl:document.getElementById("gameUrl")},this.elements.currentGameId&&(this.elements.currentGameId.textContent=this.ui.gameId),this.elements.gameUrl&&(this.elements.gameUrl.textContent=window.location.href),!this.ui.gameId||!this.isValidGameId(this.ui.gameId))return void this.showError("Invalid game ID");const e=document.getElementById("joinGameForm");e&&e.addEventListener("submit",e=>this.handleJoinGame(e)),this.initializeWasmClient(),this.initializeStatefulProxy(),this.loadStoredGameState()}initializeWasmClient(){return R(this,void 0,void 0,function*(){try{console.log("Loading WASM module..."),this.ui.connect4Client=new s,yield this.ui.connect4Client.loadWasm("/static/wasm/multiplayer_connect4.wasm"),yield this.ui.connect4Client.waitUntilReady(),console.log("WASM module loaded successfully!")}catch(e){console.error("Failed to load WASM:",e),this.showError("Failed to load game engine")}})}initializeStatefulProxy(){try{this.ui.statefulProxy=new StatefulProxy(this.ui.gameId,"indexeddb"),this.ui.statefulProxy.onStateChange(e=>{console.log("Received state patches:",e),this.applyPatches(e)}),console.log("Stateful proxy initialized")}catch(e){console.error("Failed to initialize stateful proxy:",e)}}loadStoredGameState(){try{const e=localStorage.getItem(`connect4_game_${this.ui.gameId}`);if(e){const t=JSON.parse(e);if(this.ui.gameState=m.from(t),console.log("Loaded stored game state:",this.ui.gameState),this.ui.gameState&&this.ui.gameState.players.length>0){const e=localStorage.getItem(`connect4_player_${this.ui.gameId}`);if(e)return this.ui.playerId=e,this.showGameInterface(),void this.updateGameDisplay()}}}catch(e){console.error("Failed to parse stored game state:",e)}this.showJoinForm()}handleJoinGame(e){return R(this,void 0,void 0,function*(){e.preventDefault();const t=new FormData(e.target).get("playerName");if(t.trim()){this.ui.playerId=`player_${Date.now()}`;try{const e=yield this.joinGame(t);if(e.success)this.ui.gameState=m.from(e.data),this.storeGameState(),this.showGameInterface(),this.updateGameDisplay(),this.addLogEntry(`${t} joined the game`);else{console.log("Join failed, attempting to create new game...");const e=yield this.createGame(t);if(!e.success)throw new Error(e.message||"Failed to create game");this.ui.gameState=m.from(e.data),this.storeGameState(),this.showGameInterface(),this.updateGameDisplay(),this.addLogEntry(`Game created by ${t}`)}}catch(e){console.error("Error joining game:",e),this.showError("Failed to join or create game. Please try again.")}}else alert("Please enter your name")})}joinGame(e){return R(this,void 0,void 0,function*(){if(!this.ui.connect4Client)throw new Error("WASM client not initialized");return yield this.ui.connect4Client.callMethod("connect4Service.joinGame",{gameId:this.ui.gameId,playerId:this.ui.playerId,playerName:e})})}createGame(e){return R(this,void 0,void 0,function*(){if(!this.ui.connect4Client)throw new Error("WASM client not initialized");const t=yield this.ui.connect4Client.callMethod("connect4Service.createGame",{gameId:this.ui.gameId,playerId:this.ui.playerId,playerName:e,config:{boardWidth:7,boardHeight:6,connectLength:4,maxPlayers:2,minPlayers:2,allowMultipleWinners:!1,moveTimeoutSeconds:30}});if(!t.success)throw new Error(t.message||"Failed to create game");return t})}dropPiece(e){return R(this,void 0,void 0,function*(){if(this.ui.connect4Client&&this.ui.gameState)try{const t=yield this.ui.connect4Client.callMethod("connect4Service.dropPiece",{gameId:this.ui.gameId,playerId:this.ui.playerId,column:e});t.success?(this.ui.gameState=m.from(t.data),this.storeGameState(),this.updateGameDisplay(),this.ui.statefulProxy&&this.ui.statefulProxy.sendPatches([{operation:"update",path:"",value:this.ui.gameState,timestamp:Date.now(),source:this.ui.playerId}])):console.error("Failed to drop piece:",t.message)}catch(e){console.error("Error dropping piece:",e)}else console.error("Game not properly initialized")})}applyPatches(e){for(const t of e)if("update"===t.operation&&t.value)try{const e=m.from(t.value);e&&(this.ui.gameState=e,this.storeGameState(),this.updateGameDisplay(),this.addLogEntry("Game state updated from another player"))}catch(e){console.error("Failed to apply patch:",e)}}showJoinForm(){this.elements.joinGameForm&&this.elements.joinGameForm.classList.remove("hidden"),this.elements.gameInterface&&this.elements.gameInterface.classList.add("hidden"),this.elements.errorState&&this.elements.errorState.classList.add("hidden")}showGameInterface(){this.elements.joinGameForm&&this.elements.joinGameForm.classList.add("hidden"),this.elements.gameInterface&&this.elements.gameInterface.classList.remove("hidden"),this.elements.errorState&&this.elements.errorState.classList.add("hidden"),this.initializeGameBoard()}showError(e){if(this.elements.joinGameForm&&this.elements.joinGameForm.classList.add("hidden"),this.elements.gameInterface&&this.elements.gameInterface.classList.add("hidden"),this.elements.errorState){this.elements.errorState.classList.remove("hidden");const t=this.elements.errorState.querySelector("p");t&&(t.textContent=e)}}initializeGameBoard(){var e,t,n,a;if(!this.elements.gameBoard||!(null===(e=this.ui.gameState)||void 0===e?void 0:e.board))return;const i=(null===(t=this.ui.gameState.config)||void 0===t?void 0:t.boardHeight)||6,s=(null===(n=this.ui.gameState.config)||void 0===n?void 0:n.boardWidth)||7;let o="";for(let e=0;e<i;e++){o+='<div class="board-row">';for(let t=0;t<s;t++){const n=(null===(a=this.ui.gameState.board.rows[e])||void 0===a?void 0:a.cells[t])||"";o+=`\n                    <div class="board-cell ${n?`piece-${n}`:""}" \n                         data-row="${e}" \n                         data-col="${t}"\n                         onclick="gameViewer.dropPiece(${t})">\n                        ${n?"●":""}\n                    </div>\n                `}o+="</div>"}this.elements.gameBoard.innerHTML=o}updateGameDisplay(){if(!this.ui.gameState)return;this.elements.turnNumber&&(this.elements.turnNumber.textContent=this.ui.gameState.turnNumber.toString());const e=this.ui.gameState.players.find(e=>e.id===this.ui.gameState.currentPlayerId);if(this.elements.currentPlayerName&&e&&(this.elements.currentPlayerName.textContent=e.name),this.elements.gameStatus){let e="In Progress";2===this.ui.gameState.status?e=this.ui.gameState.winners.length>0?`Game Over - Winner: ${this.ui.gameState.winners.join(", ")}`:"Game Over - Draw":this.ui.gameState.players.length<2&&(e="Waiting for players..."),this.elements.gameStatus.textContent=e}this.elements.playersList&&(this.elements.playersList.innerHTML=this.ui.gameState.players.map(e=>`\n                <div class="player-item ${e.id===this.ui.gameState.currentPlayerId?"current":""}">\n                    <span class="player-name">${e.name}</span>\n                    <span class="player-color player-color-${e.color||"red"}">●</span>\n                </div>\n            `).join("")),this.initializeGameBoard()}storeGameState(){this.ui.gameState&&(localStorage.setItem(`connect4_game_${this.ui.gameId}`,JSON.stringify(this.ui.gameState)),localStorage.setItem(`connect4_player_${this.ui.gameId}`,this.ui.playerId))}addLogEntry(e){if(!this.elements.gameLog)return;const t=(new Date).toLocaleTimeString(),n=document.createElement("div");n.className="log-entry",n.innerHTML=`<span class="timestamp">[${t}]</span> ${e}`,this.elements.gameLog.appendChild(n),this.elements.gameLog.scrollTop=this.elements.gameLog.scrollHeight}isValidGameId(e){return!(!e||0===e.length||e.length>50)&&/^[a-zA-Z0-9-]+$/.test(e)}resetGame(){confirm("Are you sure you want to start a new game?")&&(localStorage.removeItem(`connect4_game_${this.ui.gameId}`),localStorage.removeItem(`connect4_player_${this.ui.gameId}`),window.location.reload())}leaveGame(){confirm("Are you sure you want to leave this game?")&&(localStorage.removeItem(`connect4_game_${this.ui.gameId}`),localStorage.removeItem(`connect4_player_${this.ui.gameId}`),window.location.href="/")}};window.gameViewer=T,window.joinCurrentGame=()=>{const e=document.getElementById("joinGameForm");e&&e.dispatchEvent(new Event("submit"))},window.resetGame=()=>T.resetGame(),window.leaveGame=()=>T.leaveGame();const A=T;return t})());
//# sourceMappingURL=gameViewer.00cf27d70e8618cf85f8.js.map