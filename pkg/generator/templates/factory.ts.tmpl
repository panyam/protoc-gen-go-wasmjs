{{/* Import all interfaces */}}
{{range $file, $messages := .ImportsByFile}}import { {{range $i, $iface := $messages}}{{if $i}}, {{end}}{{$iface}}{{end}} } from "./{{$file}}_interfaces";
{{end}}
{{/* Import all models */}}
{{range $file, $models := .ModelImportsByFile}}import { {{range $i, $model := $models}}{{if $i}}, {{end}}{{$model}}{{end}} } from "./{{$file}}_models";
{{end}}

/**
 * Factory result interface for enhanced factory methods
 */
export interface FactoryResult<T> {
  instance: T;
  fullyLoaded: boolean;
}

/**
 * Enhanced factory with context-aware object construction
 */
export class {{.FactoryName}} {

{{range .Messages}}  /**
   * Enhanced factory method for {{.TSName}}
   * @param parent Parent object containing this field
   * @param attributeName Field name in parent object
   * @param attributeKey Array index, map key, or union tag (for containers)
   * @param data Raw data to potentially populate from
   * @returns Factory result with instance and population status
   */
  {{.MethodName}} = (
    parent?: any,
    attributeName?: string,
    attributeKey?: string | number,
    data?: any
  ): FactoryResult<{{.TSName}}Interface> => {
    const out = new Concrete{{.TSName}}();
    
    // Factory does not populate by default - let deserializer handle it
    return { instance: out, fullyLoaded: false };
  }

{{end}}

{{/* Legacy factory methods for backward compatibility - currently disabled
{{range .Messages}}  {{.MethodName}}Legacy = (data?: any): {{.TSName}}Interface => {
    const result = this.{{.MethodName}}(undefined, undefined, undefined, data);
    return result.fullyLoaded ? result.instance : this.deserializeObject(result.instance, data);
  }

{{end}}
*/}}

  /**
   * Generic object deserializer that respects factory decisions
   */
  protected deserializeObject(instance: any, data: any): any {
    if (!data || typeof data !== 'object') return instance;
    
    for (const [key, value] of Object.entries(data)) {
      if (value !== null && value !== undefined) {
        instance[key] = value;
      }
    }
    return instance;
  }
}
